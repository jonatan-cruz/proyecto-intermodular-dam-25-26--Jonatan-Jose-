<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- ============================================ -->
    <!-- VISTA FORMULARIO DE USUARIO -->
    <!-- ============================================ -->
    
    <record id="view_second_market_user_form" model="ir.ui.view">
        <field name="name">second.market.user.form</field>
        <field name="model">second.market.user</field>
        <field name="arch" type="xml">
            <form string="Usuario">
                <header>
                    <button name="action_eliminar_usuario" 
                            string="Desactivar Usuario" 
                            type="object"
                            groups="second_market.group_second_market_moderator"
                            confirm="¬øEst√°s seguro de desactivar este usuario?"
                            invisible="not activo"/>
                    <field name="activo" widget="boolean_button" 
                           options="{'terminology': 'active'}"/>
                </header>
                
                <sheet>
                    <!-- Smart Buttons -->
                    <div class="oe_button_box" name="button_box">
                        <button name="action_ver_articulos" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-shopping-bag">
                            <field name="productos_en_venta" widget="statinfo" string="En Venta"/>
                        </button>
                        <button name="action_ver_ventas" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-dollar">
                            <field name="productos_vendidos" widget="statinfo" string="Vendidos"/>
                        </button>
                        <button name="action_ver_compras" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-shopping-cart">
                            <field name="productos_comprados" widget="statinfo" string="Comprados"/>
                        </button>
                        <button name="action_ver_valoraciones" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-star">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="calificacion_promedio" widget="float" 
                                           options="{'precision': 2}"/>
                                    <small> / 5</small>
                                </span>
                                <span class="o_stat_text">Calificaci√≥n</span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Avatar -->
                    <field name="avatar" widget="image" class="oe_avatar"/>
                    
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Nombre del usuario..."/>
                        </h1>
                        <h3>
                            <field name="id_usuario" readonly="1"/>
                        </h3>
                    </div>
                    
                    <group>
                        <group name="informacion_acceso" string="Informaci√≥n de Acceso">
                            <field name="login" placeholder="email@ejemplo.com"/>
                            <field name="contrasena" password="True"/>
                            <field name="fecha_registro" readonly="1"/>
                            <field name="antiguedad" readonly="1"/>
                        </group>
                        
                        <group name="informacion_contacto" string="Informaci√≥n de Contacto">
                            <field name="telefono" placeholder="+34 123 456 789"/>
                            <field name="ubicacion" placeholder="Ciudad, Pa√≠s"/>
                        </group>
                    </group>
                    
                    <group name="biografia" string="Biograf√≠a">
                        <field name="biografia" nolabel="1" 
                               placeholder="Cu√©ntanos algo sobre ti... (m√°x 200 caracteres)"/>
                    </group>
                    
                    <!-- Notebook con pesta√±as -->
                    <notebook>
                        <!-- Pesta√±a de Estad√≠sticas -->
                        <page string="Estad√≠sticas" name="estadisticas">
                            <group>
                                <group string="Actividad de Ventas">
                                    <field name="productos_en_venta" readonly="1"/>
                                    <field name="productos_vendidos" readonly="1"/>
                                </group>
                                <group string="Actividad de Compras">
                                    <field name="productos_comprados" readonly="1"/>
                                </group>
                            </group>
                            <group>
                                <group string="Valoraciones">
                                    <field name="calificacion_promedio" readonly="1" 
                                           widget="float" options="{'precision': 2}"/>
                                    <field name="total_valoraciones" readonly="1"/>
                                </group>
                            </group>
                        </page>
                        
                        <!-- Pesta√±a de Art√≠culos -->
                        <page string="Art√≠culos" name="articulos">
                            <field name="ids_articulos_venta">
                                <list string="Art√≠culos en Venta">
                                    <field name="codigo"/>
                                    <field name="nombre"/>
                                    <field name="id_categoria"/>
                                    <field name="precio" widget="monetary"/>
                                    <field name="estado_publicacion" widget="badge"/>
                                    <field name="conteo_vistas"/>
                                    <field name="conteo_comentarios"/>
                                </list>
                            </field>
                        </page>
                        
                        <!-- Pesta√±a de Comentarios Enviados -->
                        <page string="Comentarios Enviados" name="comentarios_enviados">
                            <field name="ids_comentarios_enviados">
                                <list string="Comentarios Enviados" create="false">
                                    <field name="id_mensaje"/>
                                    <field name="fecha_hora"/>
                                    <field name="nombre_receptor"/>
                                    <field name="nombre_articulo"/>
                                    <field name="texto"/>
                                    <field name="leido" widget="boolean_toggle"/>
                                </list>
                            </field>
                        </page>
                        
                        <!-- Pesta√±a de Comentarios Recibidos -->
                        <page string="Comentarios Recibidos" name="comentarios_recibidos">
                            <field name="ids_comentarios_recibidos">
                                <list string="Comentarios Recibidos" create="false" 
                                      decoration-info="not leido">
                                    <field name="id_mensaje"/>
                                    <field name="fecha_hora"/>
                                    <field name="nombre_emisor"/>
                                    <field name="nombre_articulo"/>
                                    <field name="texto"/>
                                    <field name="leido" widget="boolean_toggle"/>
                                    <button name="leer" 
                                            string="Marcar Le√≠do" 
                                            type="object" 
                                            icon="fa-check"
                                            invisible="leido"/>
                                </list>
                            </field>
                        </page>
                        
                        <!-- Pesta√±a de Valoraciones -->
                        <page string="Valoraciones Recibidas" name="valoraciones">
                            <field name="ids_valoraciones">
                                <list string="Valoraciones" create="false">
                                    <field name="fecha_hora"/>
                                    <field name="calificacion" widget="priority"/>
                                    <field name="comentario"/>
                                </list>
                            </field>
                        </page>
                        
                    </notebook>
                    
                </sheet>
                
                <!-- Chatter -->
                <div class="oe_chatter">
                    <field name="message_follower_ids" groups="base.group_user"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>
    
    <!-- ============================================ -->
    <!-- VISTA √ÅRBOL DE USUARIOS -->
    <!-- ============================================ -->
    
    <record id="view_second_market_user_list" model="ir.ui.view">
        <field name="name">second.market.user.list</field>
        <field name="model">second.market.user</field>
        <field name="arch" type="xml">
            <list string="Usuarios" decoration-muted="not activo">
                <field name="id_usuario"/>
                <field name="avatar" widget="image" options="{'size': [40, 40]}"/>
                <field name="name"/>
                <field name="login"/>
                <field name="ubicacion"/>
                <field name="productos_en_venta"/>
                <field name="productos_vendidos"/>
                <field name="productos_comprados"/>
                <field name="calificacion_promedio" widget="float" options="{'precision': 2}"/>
                <field name="antiguedad"/>
                <field name="activo" invisible="1"/>
            </list>
        </field>
    </record>
    
    <!-- ============================================ -->
    <!-- VISTA KANBAN DE USUARIOS -->
    <!-- ============================================ -->
    
    <record id="view_second_market_user_kanban" model="ir.ui.view">
        <field name="name">second.market.user.kanban</field>
        <field name="model">second.market.user</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile">
                <field name="id"/>
                <field name="id_usuario"/>
                <field name="name"/>
                <field name="login"/>
                <field name="avatar"/>
                <field name="productos_en_venta"/>
                <field name="productos_vendidos"/>
                <field name="calificacion_promedio"/>
                <field name="activo"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click" t-attf-class="#{record.activo.raw_value ? '' : 'o_kanban_color_2'}">
                            <div class="o_kanban_image">
                                <img t-att-src="kanban_image('second.market.user', 'avatar', record.id.raw_value)" 
                                     alt="Avatar" 
                                     class="o_image_64_cover"/>
                            </div>
                            <div class="oe_kanban_details">
                                <strong class="o_kanban_record_title">
                                    <field name="name"/>
                                </strong>
                                <div class="o_kanban_record_subtitle">
                                    <field name="id_usuario"/> - <field name="login"/>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div>
                                        <span class="badge badge-pill badge-info">
                                            üõçÔ∏è <field name="productos_en_venta"/> en venta
                                        </span>
                                        <span class="badge badge-pill badge-success">
                                            ‚úÖ <field name="productos_vendidos"/> vendidos
                                        </span>
                                    </div>
                                    <div class="mt-2">
                                        ‚≠ê <field name="calificacion_promedio" widget="float" options="{'precision': 2}"/> / 5
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    <!-- ============================================ -->
    <!-- VISTA DE B√öSQUEDA -->
    <!-- ============================================ -->
    
    <record id="view_second_market_user_search" model="ir.ui.view">
        <field name="name">second.market.user.search</field>
        <field name="model">second.market.user</field>
        <field name="arch" type="xml">
            <search string="Buscar Usuarios">
                <field name="name" string="Nombre/ID/Login" 
                       filter_domain="['|', '|', ('name', 'ilike', self), ('id_usuario', 'ilike', self), ('login', 'ilike', self)]"/>
                <field name="ubicacion"/>
                
                <separator/>
                
                <!-- Filtros por estado -->
                <filter string="Activos" name="activos" 
                        domain="[('activo', '=', True)]"/>
                <filter string="Inactivos" name="inactivos" 
                        domain="[('activo', '=', False)]"/>
                
                <separator/>
                
                <!-- Filtros por actividad -->
                <filter string="Con Productos en Venta" name="con_productos" 
                        domain="[('productos_en_venta', '>', 0)]"/>
                <filter string="Sin Productos" name="sin_productos" 
                        domain="[('productos_en_venta', '=', 0)]"/>
                <filter string="Vendedores Activos" name="vendedores_activos" 
                        domain="[('productos_vendidos', '>', 0)]"/>
                <filter string="Compradores" name="compradores" 
                        domain="[('productos_comprados', '>', 0)]"/>
                
                <separator/>
                
                <!-- Filtros por calificaci√≥n -->
                <filter string="Excelente Reputaci√≥n (4.5+)" name="excelente" 
                        domain="[('calificacion_promedio', '>=', 4.5)]"/>
                <filter string="Buena Reputaci√≥n (3.5+)" name="buena" 
                        domain="[('calificacion_promedio', '>=', 3.5)]"/>
                <filter string="Sin Valoraciones" name="sin_valoraciones" 
                        domain="[('total_valoraciones', '=', 0)]"/>
                
                <separator/>
                
                <!-- Filtros por antig√ºedad -->
                <filter string="Nuevos (menos de 1 a√±o)" name="nuevos" 
                        domain="[('antiguedad', '&lt;', 1)]"/>
                <filter string="Veteranos (1+ a√±os)" name="veteranos" 
                        domain="[('antiguedad', '>=', 1)]"/>
                
                <group expand="0" string="Agrupar por">
                    <filter string="Ubicaci√≥n" name="group_ubicacion" 
                            context="{'group_by': 'ubicacion'}"/>
                    <filter string="Antig√ºedad" name="group_antiguedad" 
                            context="{'group_by': 'antiguedad'}"/>
                    <filter string="Fecha de Registro" name="group_fecha" 
                            context="{'group_by': 'fecha_registro'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- ============================================ -->
    <!-- ACCI√ìN DE VENTANA -->
    <!-- ============================================ -->
    
    <record id="action_second_market_user" model="ir.actions.act_window">
        <field name="name">Usuarios</field>
        <field name="res_model">second.market.user</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="context">{'search_default_activos': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                ¬°Crea el primer usuario!
            </p>
            <p>
                Los usuarios pueden comprar, vender, comentar y valorar art√≠culos.
            </p>
        </field>
    </record>
    
    <!-- ============================================ -->
    <!-- MEN√ö -->
    <!-- ============================================ -->
    
    <menuitem id="menu_second_market_user"
              name="Usuarios"
              parent="menu_second_market_root"
              action="action_second_market_user"
              sequence="20"/>

</odoo>